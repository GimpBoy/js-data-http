/*!
* js-data-fetch
* @version 3.0.0-beta.8 - Homepage <https://github.com/js-data/js-data-http>
* @copyright (c) 2014-2016 js-data-http project authors
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview HTTP adapter for js-data that uses the fetch API.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("js-data")):"function"==typeof define&&define.amd?define("js-data-fetch",["exports","js-data"],e):e(t.JSDataHttp=t.JSDataHttp||{},t.JSData)}(this,function(t,e){"use strict";function n(t,n,r){n||(n={}),this.data=t,e.utils.fillIn(this,n),this.op=r}function r(t){e.utils.classCallCheck(this,r),e.Component.call(this),t||(t={}),e.utils.fillIn(t,b),e.utils.fillIn(this,t)}function i(t){return null!=t&&""!==t}function o(t,e){return e||(e=""),t.filter(i).join(e)}function a(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=o(e,"/");return r.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function u(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function s(t,n){if(!n)return t;var r=[];return e.utils.forOwn(n,function(t,n){null!==t&&"undefined"!=typeof t&&(e.utils.isArray(t)||(t=[t]),t.forEach(function(t){"[object Date]"===window.toString.call(t)?t=t.toISOString():e.utils.isObject(t)&&(t=e.utils.toJson(t)),r.push(u(n)+"="+u(t))}))}),r.length>0&&(t+=(t.indexOf("?")===-1?"?":"&")+r.join("&")),t}function l(t){e.utils.classCallCheck(this,l),t||(t={}),e.utils.fillIn(t,P),r.call(this,t)}function f(t,n){if(!t||!e.utils.isString(t))throw new TypeError("action(name[, opts]): Expected: string, Found: "+("undefined"==typeof t?"undefined":c(t)));return function(r){if(r[t])throw new Error("action(name[, opts]): "+t+" already exists on target!");return n.request=n.request||function(t){return t},n.response=n.response||function(t){return t},n.responseError=n.responseError||function(t){return e.utils.reject(t)},r[t]=function(r,i){var o=this;e.utils.isObject(r)&&(i=r),i=i||{};var u=this.getAdapter(n.adapter||this.defaultAdapter||"http"),s={};if(e.utils.fillIn(s,n),!i.hasOwnProperty("endpoint")&&s.endpoint&&(i.endpoint=s.endpoint),"function"==typeof i.getEndpoint)s.url=i.getEndpoint(this,i);else{var l=[i.basePath||this.basePath||u.basePath,u.getEndpoint(this,e.utils.isSorN(r)?r:null,i)];e.utils.isSorN(r)&&l.push(r),l.push(n.pathname||t),s.url=a.apply(null,l)}return s.method=s.method||"GET",s.mapper=this.name,e.utils.deepMixIn(s,i),e.utils.resolve(s).then(i.request||n.request).then(function(t){return u.HTTP(t)}).then(function(t){return t&&t.config&&(t.config.mapper=o.name),t}).then(i.response||n.response,i.responseError||n.responseError)},r}}function h(t){return t||(t={}),function(n){return e.utils.forOwn(t,function(t,e){f(e,t)(n)}),n}}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},d=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},p=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-1];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},y=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-2];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},g=function(t){var e={},n=[];return t.forEach(function(t){t in e||(n.push(t),e[t]=0)}),n},m=function(t,n,r){r||(r={}),r.with||(r.with=[]);var i=t.relationFields||[],o=i.filter(function(t){return r.with.indexOf(t)===-1});return e.utils.omit(n,o)},b={debug:!1,raw:!1};e.Component.extend({constructor:r,afterCount:y,afterCreate:y,afterCreateMany:y,afterDestroy:y,afterDestroyAll:y,afterFind:y,afterFindAll:y,afterSum:y,afterUpdate:y,afterUpdateAll:y,afterUpdateMany:y,beforeCount:v,beforeCreate:v,beforeCreateMany:v,beforeDestroy:v,beforeDestroyAll:v,beforeFind:v,beforeFindAll:v,beforeSum:v,beforeUpdate:v,beforeUpdateAll:v,beforeUpdateMany:v,count:function(t,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),a=i.op="beforeCount",e.utils.resolve(this[a](t,r,i)).then(function(){return a=i.op="count",o.dbg(a,t,r,i),e.utils.resolve(o._count(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];f||(f={});var h=new n(l,f,a);return h=o.respond(h,i),a=i.op="afterCount",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})},create:function(t,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),a=i.op="beforeCreate",e.utils.resolve(this[a](t,r,i)).then(function(n){return r=void 0===n?r:n,r=m(t,r,i),a=i.op="create",o.dbg(a,t,r,i),e.utils.resolve(o._create(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];f||(f={});var h=new n(l,f,"create");return h.created=l?1:0,h=o.respond(h,i),a=i.op="afterCreate",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})},createMany:function(t,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),a=i.op="beforeCreateMany",e.utils.resolve(this[a](t,r,i)).then(function(n){return r=void 0===n?r:n,r=r.map(function(e){return m(t,e,i)}),a=i.op="createMany",o.dbg(a,t,r,i),e.utils.resolve(o._createMany(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];l||(l=[]),f||(f={});var h=new n(l,f,"createMany");return h.created=l.length,h=o.respond(h,i),a=i.op="afterCreateMany",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})},destroy:function(t,r,i){var o=this,a=void 0;return i||(i={}),a=i.op="beforeDestroy",e.utils.resolve(this[a](t,r,i)).then(function(){return a=i.op="destroy",o.dbg(a,t,r,i),e.utils.resolve(o._destroy(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];f||(f={});var h=new n(l,f,"destroy");return h=o.respond(h,i),a=i.op="afterDestroy",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})},destroyAll:function(t,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),a=i.op="beforeDestroyAll",e.utils.resolve(this[a](t,r,i)).then(function(){return a=i.op="destroyAll",o.dbg(a,t,r,i),e.utils.resolve(o._destroyAll(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];f||(f={});var h=new n(l,f,"destroyAll");return h=o.respond(h,i),a=i.op="afterDestroyAll",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})},loadBelongsTo:function(t,n,r,i){var o=this,a=n.getRelation();if(!e.utils.isObject(r)||e.utils.isArray(r)){var u=r.map(function(e){return o.makeBelongsToForeignKey(t,n,e)}).filter(function(t){return t});return this.findAll(a,{where:d({},a.idAttribute,{in:u})},i).then(function(t){r.forEach(function(e){t.forEach(function(t){t[a.idAttribute]===e[n.foreignKey]&&n.setLocalField(e,t)})})})}var s=function(){var e=r;return{v:o.find(a,o.makeBelongsToForeignKey(t,n,e),i).then(function(t){n.setLocalField(e,t)})}}();if("object"===("undefined"==typeof s?"undefined":c(s)))return s.v},find:function(t,r,i){var o=this,a=void 0,u=void 0;return i||(i={}),i.with||(i.with=[]),u=i.op="beforeFind",e.utils.resolve(this[u](t,r,i)).then(function(){return u=i.op="find",o.dbg(u,t,r,i),e.utils.resolve(o._find(t,r,i))}).then(function(n){var r=p(n,1),u=r[0];if(u){a=u;var s=[];return e.utils.forEachRelation(t,i,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,a,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,a,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,a,n)):r="hasOne"===e.type?o.loadHasOne(t,e,a,n):o.loadHasMany(t,e,a,n),r&&s.push(r)}),e.utils.Promise.all(s)}}).then(function(){var s=new n(a,{},"find");return s.found=a?1:0,s=o.respond(s,i),u=i.op="afterFind",e.utils.resolve(o[u](t,r,i,s)).then(function(t){return void 0===t?s:t})})},findAll:function(t,r,i){var o=this;i||(i={}),i.with||(i.with=[]);var a=[],u=void 0,s=i._activeWith;if(e.utils.isObject(s)){var l=s.query||{};s.replace?r=l:e.utils.deepFillIn(r,l)}return u=i.op="beforeFindAll",e.utils.resolve(this[u](t,r,i)).then(function(){return u=i.op="findAll",o.dbg(u,t,r,i),e.utils.resolve(o._findAll(t,r,i))}).then(function(n){var r=p(n,1),u=r[0];u||(u=[]),a=u;var s=[];return e.utils.forEachRelation(t,i,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,a,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,a,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,a,n)):r="hasMany"===e.type?o.loadHasMany(t,e,a,n):o.loadHasOne(t,e,a,n),r&&s.push(r)}),e.utils.Promise.all(s)}).then(function(){var s=new n(a,{},"findAll");return s.found=a.length,s=o.respond(s,i),u=i.op="afterFindAll",e.utils.resolve(o[u](t,r,i,s)).then(function(t){return void 0===t?s:t})})},getOpt:function(t,n){return n||(n={}),void 0===n[t]?e.utils.plainCopy(this[t]):e.utils.plainCopy(n[t])},loadHasMany:function(t,n,r,i){var o=this,a=!1;e.utils.isObject(r)&&!e.utils.isArray(r)&&(a=!0,r=[r]);var u=r.map(function(e){return o.makeHasManyForeignKey(t,n,e)}),s={where:{}},l=s.where[n.foreignKey]={};return a?l["=="]=u[0]:l.in=u.filter(function(t){return t}),this.findAll(n.getRelation(),s,i).then(function(i){r.forEach(function(r){var o=[];a?o=i:i.forEach(function(i){e.utils.get(i,n.foreignKey)===r[t.idAttribute]&&o.push(i)}),n.setLocalField(r,o)})})},loadHasManyLocalKeys:function(t,n,r,i){var o=this,a=void 0,u=n.getRelation();if(e.utils.isObject(r)&&!e.utils.isArray(r)&&(a=r),a)return this.findAll(u,{where:d({},u.idAttribute,{in:this.makeHasManyLocalKeys(t,n,a)})},i).then(function(t){n.setLocalField(a,t)});var s=function(){var a=[];return r.forEach(function(e){a=a.concat(o.makeHasManyLocalKeys(t,n,e))}),{v:o.findAll(u,{where:d({},u.idAttribute,{in:g(a).filter(function(t){return t})})},i).then(function(t){return r.forEach(function(r){var i=[],o=e.utils.get(r,n.localKeys)||[];o=e.utils.isArray(o)?o:Object.keys(o),t.forEach(function(t){o&&o.indexOf(t[u.idAttribute])!==-1&&i.push(t)}),n.setLocalField(r,i)}),t})}}();return"object"===("undefined"==typeof s?"undefined":c(s))?s.v:void 0},loadHasManyForeignKeys:function(t,n,r,i){var o=this,a=n.getRelation(),u=t.idAttribute,s=void 0;return e.utils.isObject(r)&&!e.utils.isArray(r)&&(s=r),s?this.findAll(n.getRelation(),{where:d({},n.foreignKeys,{contains:this.makeHasManyForeignKeys(t,n,s)})},i).then(function(t){n.setLocalField(s,t)}):this.findAll(a,{where:d({},n.foreignKeys,{isectNotEmpty:r.map(function(e){return o.makeHasManyForeignKeys(t,n,e)})})},i).then(function(t){var i=n.foreignKeys;r.forEach(function(r){var o=[],a=e.utils.get(r,u);t.forEach(function(n){var r=e.utils.get(t,i)||[];r.indexOf(a)!==-1&&o.push(n)}),n.setLocalField(r,o)})})},loadHasOne:function(t,n,r,i){return e.utils.isObject(r)&&!e.utils.isArray(r)&&(r=[r]),this.loadHasMany(t,n,r,i).then(function(){r.forEach(function(t){var r=n.getLocalField(t);e.utils.isArray(r)&&r.length&&n.setLocalField(t,r[0])})})},makeHasManyForeignKey:function(t,e,n){return e.getForeignKey(n)},makeHasManyLocalKeys:function(t,n,r){var i=[],o=e.utils.get(r,n.localKeys)||[];return o=e.utils.isArray(o)?o:Object.keys(o),i=i.concat(o),g(i).filter(function(t){return t})},makeHasManyForeignKeys:function(t,n,r){return e.utils.get(r,t.idAttribute)},makeBelongsToForeignKey:function(t,e,n){return e.getForeignKey(n)},sum:function(t,r,i,o){var a=this,u=void 0;if(!e.utils.isString(r))throw new Error("field must be a string!");return i||(i={}),o||(o={}),u=o.op="beforeSum",e.utils.resolve(this[u](t,r,i,o)).then(function(){return u=o.op="sum",a.dbg(u,t,r,i,o),e.utils.resolve(a._sum(t,r,i,o))}).then(function(s){var l=p(s,2),f=l[0],h=l[1];h||(h={});var c=new n(f,h,u);return c=a.respond(c,o),u=o.op="afterSum",e.utils.resolve(a[u](t,r,i,o,c)).then(function(t){return void 0===t?c:t})})},respond:function(t,e){return this.getOpt("raw",e)?t:t.data},update:function(t,r,i,o){var a=this;i||(i={}),o||(o={});var u=void 0;return u=o.op="beforeUpdate",e.utils.resolve(this[u](t,r,i,o)).then(function(n){return i=void 0===n?i:n,i=m(t,i,o),u=o.op="update",a.dbg(u,t,r,i,o),e.utils.resolve(a._update(t,r,i,o))}).then(function(s){var l=p(s,2),f=l[0],h=l[1];h||(h={});var c=new n(f,h,"update");return c.updated=f?1:0,c=a.respond(c,o),u=o.op="afterUpdate",e.utils.resolve(a[u](t,r,i,o,c)).then(function(t){return void 0===t?c:t})})},updateAll:function(t,r,i,o){var a=this;r||(r={}),i||(i={}),o||(o={});var u=void 0;return u=o.op="beforeUpdateAll",e.utils.resolve(this[u](t,r,i,o)).then(function(n){return r=void 0===n?r:n,r=m(t,r,o),u=o.op="updateAll",a.dbg(u,t,r,i,o),e.utils.resolve(a._updateAll(t,r,i,o))}).then(function(s){var l=p(s,2),f=l[0],h=l[1];f||(f=[]),h||(h={});var c=new n(f,h,"updateAll");return c.updated=f.length,c=a.respond(c,o),u=o.op="afterUpdateAll",e.utils.resolve(a[u](t,r,i,o,c)).then(function(t){return void 0===t?c:t})})},updateMany:function(t,r,i){var o=this;r||(r=[]),i||(i={});var a=void 0,u=t.idAttribute;return r=r.filter(function(t){return e.utils.get(t,u)}),a=i.op="beforeUpdateMany",e.utils.resolve(this[a](t,r,i)).then(function(n){return r=void 0===n?r:n,r=r.map(function(e){return m(t,e,i)}),a=i.op="updateMany",o.dbg(a,t,r,i),e.utils.resolve(o._updateMany(t,r,i))}).then(function(u){var s=p(u,2),l=s[0],f=s[1];l||(l=[]),f||(f={});var h=new n(l,f,"updateMany");return h.updated=l.length,h=o.respond(h,i),a=i.op="afterUpdateMany",e.utils.resolve(o[a](t,r,i,h)).then(function(t){return void 0===t?h:t})})}});var T=void 0,A=!1;try{A=window&&window.fetch}catch(t){}var P={basePath:"",forceTrailingSlash:!1,http:T,httpConfig:{},suffix:"",useFetch:!1};r.extend({constructor:l,afterDEL:y,afterGET:y,afterHTTP:y,afterPOST:y,afterPUT:y,beforeDEL:v,beforeGET:v,beforeHTTP:v,beforePOST:v,beforePUT:v,_count:function(t,e,n){var r=this;return this.GET(this.getPath("count",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_create:function(t,e,n){var r=this;return this.POST(this.getPath("create",t,e,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_createMany:function(t,e,n){var r=this;return this.POST(this.getPath("createMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroy:function(t,e,n){var r=this;return this.DEL(this.getPath("destroy",t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroyAll:function(t,e,n){var r=this;return this.DEL(this.getPath("destroyAll",t,null,n),n).then(function(e){return r._end(t,n,e)})},_end:function(t,e,n){return[this.deserialize(t,n,e),n]},_find:function(t,e,n){var r=this;return this.GET(this.getPath("find",t,e,n),n).then(function(e){return r._end(t,n,e)})},_findAll:function(t,e,n){var r=this;return this.GET(this.getPath("findAll",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_sum:function(t,e,n,r){var i=this;return this.GET(this.getPath("sum",t,r.params,r),r).then(function(e){return i._end(t,r,e)})},_update:function(t,e,n,r){var i=this;return this.PUT(this.getPath("update",t,e,r),this.serialize(t,n,r),r).then(function(e){return i._end(t,r,e)})},_updateAll:function(t,e,n,r){var i=this;return this.PUT(this.getPath("updateAll",t,null,r),this.serialize(t,e,r),r).then(function(e){return i._end(t,r,e)})},_updateMany:function(t,e,n){var r=this;return this.PUT(this.getPath("updateMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},count:function(t,n,i){return n||(n={}),i||(i={}),i.params=this.getParams(i),i.params.count=!0,i.suffix=this.getSuffix(t,i),e.utils.deepMixIn(i.params,n),i.params=this.queryTransform(t,i.params,i),r.prototype.count.call(this,t,n,i)},create:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),r.prototype.create.call(this,t,e,n)},createMany:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),r.prototype.createMany.call(this,t,e,n)},DEL:function(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"delete",o=r.op="beforeDEL",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="DEL",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterDEL",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},deserialize:function(t,n,r){return r||(r={}),e.utils.isFunction(r.deserialize)?r.deserialize(t,n,r):e.utils.isFunction(t.deserialize)?t.deserialize(t,n,r):n&&n.hasOwnProperty("data")?n.data:n},destroy:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),r.prototype.destroy.call(this,t,e,n)},destroyAll:function(t,n,i){return n||(n={}),i||(i={}),i.params=this.getParams(i),e.utils.deepMixIn(i.params,n),i.params=this.queryTransform(t,i.params,i),i.suffix=this.getSuffix(t,i),r.prototype.destroyAll.call(this,t,n,i)},error:function(){if(console){var t;(t=console)["function"==typeof console.error?"error":"log"].apply(t,arguments)}},fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,n){var r={method:t.method,headers:new Headers(t.headers)};return t.data&&(r.body=e.utils.toJson(t.data)),fetch(new Request(s(t.url,t.params),r)).then(function(e){return e.config={method:t.method,url:t.url},e.json().then(function(t){return e.data=t,e})})}),find:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),r.prototype.find.call(this,t,e,n)},findAll:function(t,n,i){return n||(n={}),i||(i={}),i.params=this.getParams(i),i.suffix=this.getSuffix(t,i),e.utils.deepMixIn(i.params,n),i.params=this.queryTransform(t,i.params,i),r.prototype.findAll.call(this,t,n,i)},GET:function(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"get",o=r.op="beforeGET",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="GET",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterGET",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},getEndpoint:function(t,n,r){var i=this;r||(r={}),r.params=e.utils.isUndefined(r.params)?{}:r.params;var o=t.relationList||[],u=e.utils.isUndefined(r.endpoint)?e.utils.isUndefined(t.endpoint)?t.name:t.endpoint:r.endpoint;return o.forEach(function(t){if("belongsTo"===t.type&&t.parent){var o=void 0,s=t.foreignKey,l=t.getRelation(),f=r.params[s];if(f===!1||!s||!l)return f===!1&&delete r.params[s],!1;if(delete r.params[s],e.utils.isObject(n)&&(o=n),o&&(f=f||t.getForeignKey(o)||(t.getLocalField(o)?e.utils.get(t.getLocalField(o),l.idAttribute):null)),f){var h=function(){delete r.endpoint;var t={};return e.utils.forOwn(r,function(e,n){t[n]=e}),e.utils._(t,l),u=a(i.getEndpoint(l,f,t),f,u),{v:!1}}();if("object"===("undefined"==typeof h?"undefined":c(h)))return h.v}}}),u},getPath:function(t,n,r,i){i||(i={});var o=[void 0===i.basePath?void 0===n.basePath?this.basePath:n.basePath:i.basePath,this.getEndpoint(n,e.utils.isString(r)||e.utils.isNumber(r)||"create"===t?r:null,i)];return"find"!==t&&"update"!==t&&"destroy"!==t||o.push(r),a.apply(e.utils,o)},getParams:function(t){return t||(t={}),void 0===t.params?{}:e.utils.copy(t.params)},getSuffix:function(t,e){return e||(e={}),void 0===e.suffix?void 0===t.suffix?this.suffix:t.suffix:e.suffix},HTTP:function(t,n){var r=this,i=new Date;n||(n={});var o=t.data,a=t.cache,u=t.timeout;t=e.utils.copy(t,null,null,null,["data","cache","timeout"]),t=e.utils.deepMixIn(t,this.httpConfig),t.data=o,t.cache=a,t.timeout=u,this.forceTrailingSlash&&"/"!==t.url[t.url.length-1]&&(t.url+="/"),t.method=t.method.toUpperCase();var s=t.suffix||n.suffix||this.suffix;s&&t.url.substr(t.url.length-s.length)!==s&&(t.url+=s);var l=function(n){var o=i.toUTCString()+" - "+t.method.toUpperCase()+" "+t.url+" - "+n.status+" "+((new Date).getTime()-i.getTime())+"ms";return n.status>=200&&n.status<300?(r.log&&r.dbg("debug",o,n),n):(r.error&&r.error("'FAILED: "+o,n),e.utils.reject(n))};if(!this.http)throw new Error("You have not configured this adapter with an http library!");return e.utils.resolve(this.beforeHTTP(t,n)).then(function(e){return t=e||t,A&&(r.useFetch||n.useFetch||!r.http)?r.fetch(t,n).then(l,l):r.http(t).then(l,l).catch(function(e){return r.responseError(e,t,n)})}).then(function(i){return e.utils.resolve(r.afterHTTP(t,n,i)).then(function(t){return void 0===t?i:t})})},POST:function(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"post",a=i.op="beforePOST",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,a=i.op="POST",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(u){return a=i.op="afterPOST",e.utils.resolve(o[a](t,n,r,i,u)).then(function(t){return void 0===t?u:t})})},PUT:function(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"put",a=i.op="beforePUT",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,a=i.op="PUT",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(u){return a=i.op="afterPUT",e.utils.resolve(o[a](t,n,r,i,u)).then(function(t){return void 0===t?u:t})})},queryTransform:function(t,n,r){return r||(r={}),e.utils.isFunction(r.queryTransform)?r.queryTransform(t,n,r):e.utils.isFunction(t.queryTransform)?t.queryTransform(t,n,r):n},responseError:function(t,n,r){return e.utils.reject(t)},serialize:function(t,n,r){return r||(r={}),e.utils.isFunction(r.serialize)?r.serialize(t,n,r):e.utils.isFunction(t.serialize)?t.serialize(t,n,r):n},sum:function(t,n,i,o){if(i||(i={}),o||(o={}),!e.utils.utils.isString(n))throw new Error("field must be a string!");return o.params=this.getParams(o),o.params.sum=n,o.suffix=this.getSuffix(t,o),e.utils.deepMixIn(o.params,i),o.params=this.queryTransform(t,o.params,o),r.prototype.sum.call(this,t,n,i,o)},update:function(t,e,n,i){return i||(i={}),i.params=this.getParams(i),i.params=this.queryTransform(t,i.params,i),i.suffix=this.getSuffix(t,i),r.prototype.update.call(this,t,e,n,i)},updateAll:function(t,n,i,o){return i||(i={}),o||(o={}),o.params=this.getParams(o),e.utils.deepMixIn(o.params,i),o.params=this.queryTransform(t,o.params,o),o.suffix=this.getSuffix(t,o),r.prototype.updateAll.call(this,t,n,i,o)},updateMany:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),r.prototype.updateMany.call(this,t,e,n)}});var w={beta:8,full:"3.0.0-beta.8",major:3,minor:0,patch:0};t.HttpAdapter=l,t.addAction=f,t.addActions=h,t.version=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=js-data-fetch.min.map