/*!
* js-data-fetch
* @version 3.0.0-alpha.2 - Homepage <http://www.js-data.io/docs/dshttpadapter>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2016 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview Fetch HTTP (XHR) adapter for js-data in the browser.
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("js-data"),require("undefined")):"function"==typeof define&&define.amd?define(["js-data","undefined"],e):"object"==typeof exports?exports.DSHttpAdapter=e(require("js-data"),require("undefined")):t.DSHttpAdapter=e(t.JSData,t.undefined)}(this,function(t,e){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return null!=t&&""!==t}function o(t,e){return e||(e=""),t.filter(r).join(e)}function i(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=o(e,"/");return r.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function u(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function a(t,e){if(!e)return t;var n=[];return b(e,function(t,e){null!==t&&"undefined"!=typeof t&&(y(t)||(t=[t]),t.forEach(function(t){"[object Date]"===window.toString.call(t)?t=t.toISOString():x(t)&&(t=D(t)),n.push(u(e)+"="+u(t))}))}),n.length>0&&(t+=(-1===t.indexOf("?")?"?":"&")+n.join("&")),t}function f(t){var e=this;t||(t={}),e.basePath=void 0===t.basePath?"":t.basePath,e.debug=void 0===t.debug?!1:t.debug,e.forceTrailingSlash=void 0===t.forceTrailingSlash?!1:t.forceTrailingSlash,e.http=void 0===t.http?p:t.http,e.httpConfig=void 0===t.httpConfig?{}:t.httpConfig,e.suffix=void 0===t.suffix?"":t.suffix,e.useFetch=void 0===t.useFetch?!1:t.useFetch}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},c=n(1),p=n(2),d=c.utils._,l=c.utils.copy,h=c.utils.deepMixIn,m=c.utils.extend,g=c.utils.fillIn,b=c.utils.forOwn,y=c.utils.isArray,T=c.utils.isFunction,v=c.utils.isNumber,x=c.utils.isObject,P=c.utils.isSorN,A=c.utils.isString,E=c.utils.resolve,S=c.utils.reject,D=c.utils.toJson,w=!1;try{w=window&&window.fetch}catch(t){}g(f.prototype,{beforeCreate:function(){},create:function(t,e,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(t,n.params,n),n.suffix||(n.suffix=t.suffix),n.op="create",r.dbg(n.op,t,e,n),E(r.beforeCreate(t,e,n)).then(function(){return r.POST(r.getPath("create",t,e,n),r.serialize(t,e,n),n)}).then(function(e){return r.deserialize(t,e,n)}).then(function(o){return E(r.afterCreate(t,e,n,o)).then(function(t){return t||o})})},afterCreate:function(){},dbg:function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];this.log.apply(this,["debug"].concat(e))},beforeDEL:function(){},DEL:function(t,e,n){var r=this;return e||(e={}),e.url=t||e.url,e.method=e.method||"delete",E(r.beforeDEL(t,e,n)).then(function(t){return e=t||e,r.HTTP(e,n)}).then(function(o){return E(r.afterDEL(t,e,n,o)).then(function(t){return t||o})})},afterDEL:function(){},deserialize:function(t,e,n){return n||(n={}),T(n.deserialize)?n.deserialize(t,e,n):T(t.deserialize)?t.deserialize(t,e,n):n.raw?e:e&&"data"in e?e.data:e},beforeDestroy:function(){},destroy:function(t,e,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(t,n.params,n),n.suffix||(n.suffix=t.suffix),n.op="destroy",r.dbg(n.op,t,e,n),E(r.beforeDestroy(t,e,n)).then(function(){return r.DEL(r.getPath("destroy",t,e,n),n)}).then(function(e){return r.deserialize(t,e,n)}).then(function(o){return E(r.afterDestroy(t,e,n,o)).then(function(t){return t||o})})},afterDestroy:function(){},beforeDestroyAll:function(){},destroyAll:function(t,e,n){var r=this;return e||(e={}),n=n?l(n):{},n.params||(n.params={}),h(n.params,e),n.params=r.queryTransform(t,n.params,n),n.suffix||(n.suffix=t.suffix),n.op="destroy",r.dbg(n.op,t,e,n),E(r.beforeDestroyAll(t,e,n)).then(function(){return r.DEL(r.getPath("destroyAll",t,n.params,n),n)}).then(function(e){return r.deserialize(t,e,n)}).then(function(o){return E(r.afterDestroyAll(t,e,n,o)).then(function(t){return t||o})})},afterDestroyAll:function(){},error:function(){if(console){var t;(t=console)["function"==typeof console.error?"error":"log"].apply(t,arguments)}},fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var n={method:t.method,headers:new Headers(t.headers)};return t.data&&(n.body=D(t.data)),fetch(new Request(a(t.url,t.params),n)).then(function(e){return e.config={method:t.method,url:t.url},e.json().then(function(t){return e.data=t,e})})}),beforeFind:function(){},find:function(t,e,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(t,n.params,n),n.suffix||(n.suffix=t.suffix),n.op="find",r.dbg(n.op,t,e,n),E(r.beforeFind(t,e,n)).then(function(){return r.GET(r.getPath("find",t,e,n),n)}).then(function(e){return r.deserialize(t,e,n)}).then(function(o){return E(r.afterFind(t,e,n,o)).then(function(t){return t||o})})},afterFind:function(){},beforeFindAll:function(){},findAll:function(t,e,n){var r=this;return e||(e={}),n=n?l(n):{},n.params||(n.params={}),n.suffix||(n.suffix=t.suffix),n.op="findAll",r.dbg(n.op,t,e,n),h(n.params,e),n.params=r.queryTransform(t,n.params,n),E(r.beforeFindAll(t,e,n)).then(function(){return r.GET(r.getPath("findAll",t,n.params,n),n)}).then(function(e){return r.deserialize(t,e,n)}).then(function(o){return E(r.afterFindAll(t,e,n,o)).then(function(t){return t||o})})},afterFindAll:function(){},beforeGET:function(){},GET:function(t,e,n){var r=this;return e||(e={}),e.url=t||e.url,e.method=e.method||"get",E(r.beforeGET(t,e,n)).then(function(t){return e=t||e,r.HTTP(e,n)}).then(function(o){return E(r.afterGET(t,e,n,o)).then(function(t){return t||o})})},afterGET:function(){},getEndpoint:function(t,e,n){var r=this;n||(n={}),n.params||(n.params={});var o=void 0,u=t.parentKey,a=n.hasOwnProperty("endpoint")?n.endpoint:t.endpoint,f=t.parentField,c=t.parent?t.getResource(t.parent):void 0,p=n.params[u];if(p===!1||!u||!c)return p===!1&&delete n.params[u],a;if(delete n.params[u],A(e)||v(e)?o=t.get(e):x(e)&&(o=e),o&&(p=p||o[u]||(o[f]?o[f][c.idAttribute]:null)),!p)return a;var l=function(){delete n.endpoint;var t={};return b(n,function(e,n){t[n]=e}),d(t,c),{v:i(r.getEndpoint(c,p,t,p,a))}}();return"object"===("undefined"==typeof l?"undefined":s(l))?l.v:void 0},getPath:function(t,e,n,r){var o=this;r||(r={});var u=[void 0===r.basePath?void 0===e.basePath?o.basePath:e.basePath:r.basePath,o.getEndpoint(e,A(n)||v(n)||"create"===t?n:null,r)];return("find"===t||"update"===t||"destroy"===t)&&u.push(n),i.apply(c.utils,u)},beforeHTTP:function(){},HTTP:function(t,e){function n(e){var n=o.toUTCString()+" - "+t.method.toUpperCase()+" "+t.url+" - "+e.status+" "+((new Date).getTime()-o.getTime())+"ms";return e.status>=200&&e.status<300?(r.log&&r.dbg("debug",n,e),e):(r.error&&r.error("'FAILED: "+n,e),S(e))}var r=this,o=new Date;e||(e={}),t=l(t),t=h(t,r.httpConfig),r.forceTrailingSlash&&"/"!==t.url[t.url.length-1]&&(t.url+="/"),t.method=t.method.toUpperCase();var i=t.suffix||e.suffix||r.suffix;if(i&&t.url.substr(t.url.length-i.length)!==i&&(t.url+=i),!r.http)throw new Error("You have not configured this adapter with an http library!");return E(r.beforeHTTP(t)).then(function(o){return t=o||t,w&&(r.useFetch||e.useFetch||!r.http)?r.fetch(t,e).then(n,n):r.http(t).then(n,n)}).then(function(e){return E(r.afterHTTP(t,e)).then(function(t){return t||e})})},afterHTTP:function(){},queryTransform:function(t,e,n){return e},serialize:function(t,e,n){return n||(n={}),T(n.serialize)?n.serialize(t,e,n):e},log:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];if(t&&!n.length&&(n.push(t),t="debug"),"debug"!==t||this.debug){var o=t.toUpperCase()+": ("+this.name+")";if(console[t]){var i;(i=console)[t].apply(i,[o].concat(n))}else{var u;(u=console).log.apply(u,[o].concat(n))}}},beforePOST:function(){},POST:function(t,e,n,r){var o=this;return n||(n={}),n.url=t||n.url,n.data=e||n.data,n.method=n.method||"post",E(o.beforePOST(t,e,n,r)).then(function(t){return n=t||n,o.HTTP(n,r)}).then(function(i){return E(o.afterPOST(t,e,n,r,i)).then(function(t){return t||i})})},afterPOST:function(){},beforePUT:function(){},PUT:function(t,e,n,r){var o=this;return n||(n={}),n.url=t||n.url,n.data=e||n.data,n.method=n.method||"put",E(o.beforePUT(t,e,n,r)).then(function(t){return n=t||n,o.HTTP(n,r)}).then(function(i){return E(o.afterPUT(t,e,n,r,i)).then(function(t){return t||i})})},afterPUT:function(){},beforeUpdate:function(){},update:function(t,e,n,r){var o=this;return r=r?l(r):{},r.params||(r.params={}),r.params=o.queryTransform(t,r.params,r),r.suffix||(r.suffix=t.suffix),r.op="update",o.dbg(r.op,t,e,n,r),E(o.beforeUpdate(t,e,n,r)).then(function(){return o.PUT(o.getPath("update",t,e,r),o.serialize(t,n,r),r)}).then(function(e){return o.deserialize(t,e,r)}).then(function(i){return E(o.afterUpdate(t,e,n,r,i)).then(function(t){return t||i})})},afterUpdate:function(){},beforeUpdateAll:function(){},updateAll:function(t,e,n,r){var o=this;return n||(n={}),r=r?l(r):{},r.params||(r.params={}),h(r.params,n),r.params=o.queryTransform(t,r.params,r),r.suffix||(r.suffix=t.suffix),r.op="updateAll",o.dbg(r.op,t,e,n,r),E(o.beforeUpdateAll(t,e,n,r)).then(function(){return o.PUT(o.getPath("updateAll",t,r.params,r),o.serialize(t,e,r),r)}).then(function(e){return o.deserialize(t,e,r)}).then(function(i){return E(o.afterUpdateAll(t,e,n,r,i)).then(function(t){return t||i})})},afterUpdateAll:function(){}}),f.addAction=function(t,e){if(!t||!A(t))throw new TypeError("action(name[, opts]): Expected: string, Found: "+("undefined"==typeof t?"undefined":s(t)));return function(n){if(n[t])throw new Error("action(name[, opts]): "+t+" already exists on target!");return e.request=e.request||function(t){return t},e.response=e.response||function(t){return t},e.responseError=e.responseError||function(t){return S(t)},n[t]=function(n,r){x(n)&&(r=n),r=r||{};var o=this.getAdapter(e.adapter||this.defaultAdapter||"http"),u={};if(g(u,e),!r.hasOwnProperty("endpoint")&&u.endpoint&&(r.endpoint=u.endpoint),"function"==typeof r.getEndpoint)u.url=r.getEndpoint(this,r);else{var a=[r.basePath||this.basePath||o.defaults.basePath,o.getEndpoint(this,P(n)?n:null,r)];P(n)&&a.push(n),a.push(e.pathname||t),u.url=i.apply(null,a)}return u.method=u.method||"GET",u.modelName=this.name,h(u)(r),E(u).then(r.request||e.request).then(function(t){return o.HTTP(t)}).then(function(t){return t&&t.config&&(t.config.modelName=this.name),t}).then(r.response||e.response,r.responseError||e.responseError)},n}},f.addActions=function(t){return t||(t={}),function(t){return b(t,function(e,n){f.addAction(n,e)(t)}),t}},f.extend=m,f.version={full:"<%= pkg.version %>",major:parseInt("<%= major %>",10),minor:parseInt("<%= minor %>",10),patch:parseInt("<%= patch %>",10),alpha:"<%= alpha %>",beta:"<%= beta %>"},t.exports=f},function(e,n){e.exports=t},function(t,e){t.exports=void 0}])});
//# sourceMappingURL=fetch/dist/js-data-fetch.min.map