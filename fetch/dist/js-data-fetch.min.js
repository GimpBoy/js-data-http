/*!
* js-data-fetch
* @version 3.0.0 - Homepage <https://github.com/js-data/js-data-http>
* @copyright (c) 2014-2016 js-data-http project authors
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview HTTP adapter for js-data that uses the fetch API.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("js-data")):"function"==typeof define&&define.amd?define("js-data-fetch",["exports","js-data"],e):e(t.JSDataHttp=t.JSDataHttp||{},t.JSData)}(this,function(t,e){"use strict";function Response(t,n,r){n||(n={}),this.data=t,e.utils.fillIn(this,n),this.op=r}function Adapter(t){e.utils.classCallCheck(this,Adapter),e.Component.call(this,t),t||(t={}),e.utils.fillIn(t,l),e.utils.fillIn(this,t)}function isValidString(t){return null!=t&&""!==t}function join(t,e){return e||(e=""),t.filter(isValidString).join(e)}function makePath(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return join(e,"/").replace(/([^:/]|^)\/{2,}/g,"$1/")}function encode(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildUrl(t,n){if(!n)return t;var r=[];return e.utils.forOwn(n,function(t,n){null!==t&&void 0!==t&&(e.utils.isArray(t)||(t=[t]),t.forEach(function(t){"[object Date]"===toString.call(t)?t=t.toISOString():e.utils.isObject(t)&&(t=e.utils.toJson(t)),r.push(encode(n)+"="+encode(t))}))}),r.length>0&&(t+=(-1===t.indexOf("?")?"?":"&")+r.join("&")),t}function HttpAdapter(t){e.utils.classCallCheck(this,HttpAdapter),t||(t={}),e.utils.fillIn(t,d),Adapter.call(this,t)}function addAction(t,r){if(!t||!e.utils.isString(t))throw new TypeError("action(name[, opts]): Expected: string, Found: "+(void 0===t?"undefined":n(t)));return function(n){if(n[t])throw new Error("action(name[, opts]): "+t+" already exists on target!");return r.request=r.request||function(t){return t},r.response=r.response||function(t){return t},r.responseError=r.responseError||function(t){return e.utils.reject(t)},n[t]=function(n,i){var o=this;i=i||{},e.utils.isObject(n)&&(i=n),e.utils.fillIn(i,r);var a=this.getAdapter(i.adapter||this.defaultAdapter||"http"),s={};if(s.mapper=this.name,e.utils.deepMixIn(s,i),s.method=s.method||"GET","function"==typeof i.getEndpoint)s.url=i.getEndpoint(this,i);else{var u=[i.basePath||this.basePath||a.basePath,a.getEndpoint(this,n,i)];e.utils.isSorN(n)&&u.push(n),u.push(r.pathname||t),s.url=makePath.apply(null,u)}return e.utils.resolve(s).then(i.request).then(function(t){return a.HTTP(t)}).then(function(t){return t&&t.config&&(t.config.mapper=o.name),t}).then(i.response,i.responseError)},n}}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},i=function(){function sliceIterator(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return sliceIterator(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function noop(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-1];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},a=function noop2(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-2];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},s=function unique(t){var e={},n=[];return t.forEach(function(t){t in e||(n.push(t),e[t]=0)}),n},u=function withoutRelations(t,n,r){r||(r={}),r.with||(r.with=[]);var i=(t.relationFields||[]).filter(function(t){return-1===r.with.indexOf(t)});return e.utils.omit(n,i)},l={debug:!1,raw:!1};e.Component.extend({constructor:Adapter,afterCount:a,afterCreate:a,afterCreateMany:a,afterDestroy:a,afterDestroyAll:a,afterFind:a,afterFindAll:a,afterSum:a,afterUpdate:a,afterUpdateAll:a,afterUpdateMany:a,beforeCount:o,beforeCreate:o,beforeCreateMany:o,beforeDestroy:o,beforeDestroyAll:o,beforeFind:o,beforeFindAll:o,beforeSum:o,beforeUpdate:o,beforeUpdateAll:o,beforeUpdateMany:o,count:function count(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCount",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="count",o.dbg(a,t,n,r),e.utils.resolve(o._count(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];f||(f={});var d=new Response(l,f,a);return d=o.respond(d,r),a=r.op="afterCount",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})},create:function create(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreate",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=u(t,n,r),a=r.op="create",o.dbg(a,t,n,r),e.utils.resolve(o._create(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];f||(f={});var d=new Response(l,f,"create");return d.created=l?1:0,d=o.respond(d,r),a=r.op="afterCreate",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})},createMany:function createMany(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreateMany",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(e){return u(t,e,r)}),a=r.op="createMany",o.dbg(a,t,n,r),e.utils.resolve(o._createMany(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];l||(l=[]),f||(f={});var d=new Response(l,f,"createMany");return d.created=l.length,d=o.respond(d,r),a=r.op="afterCreateMany",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})},destroy:function destroy(t,n,r){var o=this,a=void 0;return r||(r={}),a=r.op="beforeDestroy",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="destroy",o.dbg(a,t,n,r),e.utils.resolve(o._destroy(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];f||(f={});var d=new Response(l,f,"destroy");return d=o.respond(d,r),a=r.op="afterDestroy",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})},destroyAll:function destroyAll(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeDestroyAll",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="destroyAll",o.dbg(a,t,n,r),e.utils.resolve(o._destroyAll(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];f||(f={});var d=new Response(l,f,"destroyAll");return d=o.respond(d,r),a=r.op="afterDestroyAll",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})},loadBelongsTo:function loadBelongsTo(t,n,i,o){var a=this,s=n.getRelation();if(e.utils.isObject(i)&&!e.utils.isArray(i)){var u=i;return this.find(s,this.makeBelongsToForeignKey(t,n,u),o).then(function(t){n.setLocalField(u,t)})}var l=i.map(function(e){return a.makeBelongsToForeignKey(t,n,e)}).filter(function(t){return t});return this.findAll(s,{where:r({},s.idAttribute,{in:l})},o).then(function(t){i.forEach(function(e){t.forEach(function(t){t[s.idAttribute]===e[n.foreignKey]&&n.setLocalField(e,t)})})})},find:function find(t,n,r){var o=this,a=void 0;return r||(r={}),r.with||(r.with=[]),a=r.op="beforeFind",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="find",o.dbg(a,t,n,r),e.utils.resolve(o._find(t,n,r))}).then(function(e){return o.loadRelationsFor(t,e,r)}).then(function(s){var u=i(s,2),l=u[0],f=new Response(l,u[1],"find");return f.found=l?1:0,f=o.respond(f,r),a=r.op="afterFind",e.utils.resolve(o[a](t,n,r,f)).then(function(t){return void 0===t?f:t})})},findAll:function findAll(t,n,r){var o=this,a=void 0;r||(r={}),r.with||(r.with=[]);var s=r._activeWith;if(e.utils.isObject(s)){var u=s.query||{};s.replace?n=u:e.utils.deepFillIn(n,u)}return a=r.op="beforeFindAll",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="findAll",o.dbg(a,t,n,r),e.utils.resolve(o._findAll(t,n,r))}).then(function(e){return o.loadRelationsFor(t,e,r)}).then(function(s){var u=i(s,2),l=u[0],f=new Response(l,u[1],"findAll");return f.found=l.length,f=o.respond(f,r),a=r.op="afterFindAll",e.utils.resolve(o[a](t,n,r,f)).then(function(t){return void 0===t?f:t})})},loadRelationsFor:function loadRelationsFor(t,n,r){var o=this,a=i(n,1)[0],s=[];return a&&e.utils.forEachRelation(t,r,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,a,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,a,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,a,n)):r="hasOne"===e.type?o.loadHasOne(t,e,a,n):o.loadHasMany(t,e,a,n),r&&s.push(r)}),e.utils.Promise.all(s).then(function(){return n})},getOpt:function getOpt(t,n){return n||(n={}),void 0===n[t]?e.utils.plainCopy(this[t]):e.utils.plainCopy(n[t])},loadHasMany:function loadHasMany(t,n,r,i){var o=this,a=!1;e.utils.isObject(r)&&!e.utils.isArray(r)&&(a=!0,r=[r]);var s=r.map(function(e){return o.makeHasManyForeignKey(t,n,e)}),u={where:{}},l=u.where[n.foreignKey]={};return a?l["=="]=s[0]:l.in=s.filter(function(t){return t}),this.findAll(n.getRelation(),u,i).then(function(i){r.forEach(function(r){var o=[];a?o=i:i.forEach(function(i){e.utils.get(i,n.foreignKey)===r[t.idAttribute]&&o.push(i)}),n.setLocalField(r,o)})})},loadHasManyLocalKeys:function loadHasManyLocalKeys(t,n,i,o){var a=this,u=void 0,l=n.getRelation();if(e.utils.isObject(i)&&!e.utils.isArray(i)&&(u=i),u)return this.findAll(l,{where:r({},l.idAttribute,{in:this.makeHasManyLocalKeys(t,n,u)})},o).then(function(t){n.setLocalField(u,t)});var f=[];return i.forEach(function(e){f=f.concat(a.makeHasManyLocalKeys(t,n,e))}),this.findAll(l,{where:r({},l.idAttribute,{in:s(f).filter(function(t){return t})})},o).then(function(t){return i.forEach(function(r){var i=[],o=e.utils.get(r,n.localKeys)||[];o=e.utils.isArray(o)?o:Object.keys(o),t.forEach(function(t){o&&-1!==o.indexOf(t[l.idAttribute])&&i.push(t)}),n.setLocalField(r,i)}),t})},loadHasManyForeignKeys:function loadHasManyForeignKeys(t,n,i,o){var a=this,s=n.getRelation(),u=t.idAttribute,l=void 0;return e.utils.isObject(i)&&!e.utils.isArray(i)&&(l=i),l?this.findAll(n.getRelation(),{where:r({},n.foreignKeys,{contains:this.makeHasManyForeignKeys(t,n,l)})},o).then(function(t){n.setLocalField(l,t)}):this.findAll(s,{where:r({},n.foreignKeys,{isectNotEmpty:i.map(function(e){return a.makeHasManyForeignKeys(t,n,e)})})},o).then(function(t){var r=n.foreignKeys;i.forEach(function(i){var o=[],a=e.utils.get(i,u);t.forEach(function(n){-1!==(e.utils.get(t,r)||[]).indexOf(a)&&o.push(n)}),n.setLocalField(i,o)})})},loadHasOne:function loadHasOne(t,n,r,i){return e.utils.isObject(r)&&!e.utils.isArray(r)&&(r=[r]),this.loadHasMany(t,n,r,i).then(function(){r.forEach(function(t){var r=n.getLocalField(t);e.utils.isArray(r)&&r.length&&n.setLocalField(t,r[0])})})},makeHasManyForeignKey:function makeHasManyForeignKey(t,e,n){return e.getForeignKey(n)},makeHasManyLocalKeys:function makeHasManyLocalKeys(t,n,r){var i=[],o=e.utils.get(r,n.localKeys)||[];return o=e.utils.isArray(o)?o:Object.keys(o),i=i.concat(o),s(i).filter(function(t){return t})},makeHasManyForeignKeys:function makeHasManyForeignKeys(t,n,r){return e.utils.get(r,t.idAttribute)},makeBelongsToForeignKey:function makeBelongsToForeignKey(t,e,n){return e.getForeignKey(n)},sum:function sum(t,n,r,o){var a=this,s=void 0;if(!e.utils.isString(n))throw new Error("field must be a string!");return r||(r={}),o||(o={}),s=o.op="beforeSum",e.utils.resolve(this[s](t,n,r,o)).then(function(){return s=o.op="sum",a.dbg(s,t,n,r,o),e.utils.resolve(a._sum(t,n,r,o))}).then(function(u){var l=i(u,2),f=l[0],d=l[1];d||(d={});var c=new Response(f,d,s);return c=a.respond(c,o),s=o.op="afterSum",e.utils.resolve(a[s](t,n,r,o,c)).then(function(t){return void 0===t?c:t})})},respond:function respond(t,e){return this.getOpt("raw",e)?t:t.data},update:function update(t,n,r,o){var a=this;r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdate",e.utils.resolve(this[s](t,n,r,o)).then(function(i){return r=void 0===i?r:i,r=u(t,r,o),s=o.op="update",a.dbg(s,t,n,r,o),e.utils.resolve(a._update(t,n,r,o))}).then(function(u){var l=i(u,2),f=l[0],d=l[1];d||(d={});var c=new Response(f,d,"update");return c.updated=f?1:0,c=a.respond(c,o),s=o.op="afterUpdate",e.utils.resolve(a[s](t,n,r,o,c)).then(function(t){return void 0===t?c:t})})},updateAll:function updateAll(t,n,r,o){var a=this;n||(n={}),r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdateAll",e.utils.resolve(this[s](t,n,r,o)).then(function(i){return n=void 0===i?n:i,n=u(t,n,o),s=o.op="updateAll",a.dbg(s,t,n,r,o),e.utils.resolve(a._updateAll(t,n,r,o))}).then(function(u){var l=i(u,2),f=l[0],d=l[1];f||(f=[]),d||(d={});var c=new Response(f,d,"updateAll");return c.updated=f.length,c=a.respond(c,o),s=o.op="afterUpdateAll",e.utils.resolve(a[s](t,n,r,o,c)).then(function(t){return void 0===t?c:t})})},updateMany:function updateMany(t,n,r){var o=this;n||(n=[]),r||(r={});var a=void 0,s=t.idAttribute;return n=n.filter(function(t){return e.utils.get(t,s)}),a=r.op="beforeUpdateMany",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(e){return u(t,e,r)}),a=r.op="updateMany",o.dbg(a,t,n,r),e.utils.resolve(o._updateMany(t,n,r))}).then(function(s){var u=i(s,2),l=u[0],f=u[1];l||(l=[]),f||(f={});var d=new Response(l,f,"updateMany");return d.updated=l.length,d=o.respond(d,r),a=r.op="afterUpdateMany",e.utils.resolve(o[a](t,n,r,d)).then(function(t){return void 0===t?d:t})})}});var f=!1;try{f=window&&window.fetch}catch(t){}var d={basePath:"",forceTrailingSlash:!1,hasFetch:f,http:void 0,httpConfig:{},suffix:"",useFetch:!1};Adapter.extend({constructor:HttpAdapter,afterDEL:a,afterGET:a,afterHTTP:a,afterPOST:a,afterPUT:a,beforeDEL:o,beforeGET:o,beforeHTTP:o,beforePOST:o,beforePUT:o,_count:function _count(t,e,n){var r=this;return this.GET(this.getPath("count",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_create:function _create(t,e,n){var r=this;return this.POST(this.getPath("create",t,e,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_createMany:function _createMany(t,e,n){var r=this;return this.POST(this.getPath("createMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroy:function _destroy(t,e,n){var r=this;return this.DEL(this.getPath("destroy",t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroyAll:function _destroyAll(t,e,n){var r=this;return this.DEL(this.getPath("destroyAll",t,null,n),n).then(function(e){return r._end(t,n,e)})},_end:function _end(t,e,n){return[this.deserialize(t,n,e),n]},_find:function _find(t,e,n){var r=this;return this.GET(this.getPath("find",t,e,n),n).then(function(e){return r._end(t,n,e)})},_findAll:function _findAll(t,e,n){var r=this;return this.GET(this.getPath("findAll",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_sum:function _sum(t,e,n,r){var i=this;return this.GET(this.getPath("sum",t,r.params,r),r).then(function(e){return i._end(t,r,e)})},_update:function _update(t,e,n,r){var i=this;return this.PUT(this.getPath("update",t,e,r),this.serialize(t,n,r),r).then(function(e){return i._end(t,r,e)})},_updateAll:function _updateAll(t,e,n,r){var i=this;return this.PUT(this.getPath("updateAll",t,null,r),this.serialize(t,e,r),r).then(function(e){return i._end(t,r,e)})},_updateMany:function _updateMany(t,e,n){var r=this;return this.PUT(this.getPath("updateMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},count:function count(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.params.count=!0,r.suffix=this.getSuffix(t,r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),Adapter.prototype.count.call(this,t,n,r)},create:function create(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),Adapter.prototype.create.call(this,t,e,n)},createMany:function createMany(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),Adapter.prototype.createMany.call(this,t,e,n)},DEL:function DEL(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"delete",o=r.op="beforeDEL",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="DEL",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterDEL",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},deserialize:function deserialize(t,n,r){return r||(r={}),e.utils.isFunction(r.deserialize)?r.deserialize(t,n,r):e.utils.isFunction(t.deserialize)?t.deserialize(t,n,r):n&&n.hasOwnProperty("data")?n.data:n},destroy:function destroy(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),Adapter.prototype.destroy.call(this,t,e,n)},destroyAll:function destroyAll(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),r.suffix=this.getSuffix(t,r),Adapter.prototype.destroyAll.call(this,t,n,r)},error:function error(){if(console){var t;(t=console)["function"==typeof console.error?"error":"log"].apply(t,arguments)}},fetch:function(t){function fetch(e){return t.apply(this,arguments)}return fetch.toString=function(){return t.toString()},fetch}(function(t){var n={method:t.method,headers:new Headers(t.headers||{})};return t.data&&(n.body=e.utils.toJson(t.data)),fetch(buildUrl(t.url,t.params),n).then(function(e){return e.config={method:t.method,url:t.url},e.json().then(function(t){return e.data=t,e})})}),find:function find(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),Adapter.prototype.find.call(this,t,e,n)},findAll:function findAll(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.suffix=this.getSuffix(t,r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),Adapter.prototype.findAll.call(this,t,n,r)},GET:function GET(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"get",o=r.op="beforeGET",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="GET",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterGET",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},getEndpoint:function getEndpoint(t,n,r){var i=this;r||(r={}),r.params=e.utils.isUndefined(r.params)?{}:r.params;var o=t.relationList||[],a=e.utils.isUndefined(r.endpoint)?e.utils.isUndefined(t.endpoint)?t.name:t.endpoint:r.endpoint;return o.forEach(function(t){if("belongsTo"===t.type&&t.parent){var o=void 0,s=t.foreignKey,u=t.getRelation(),l=r.params[s];if(!1===l||!s||!u)return!1===l&&delete r.params[s],!1;if(delete r.params[s],e.utils.isObject(n)&&(o=n),o&&(l=l||t.getForeignKey(o)||(t.getLocalField(o)?e.utils.get(t.getLocalField(o),u.idAttribute):null)),l){delete r.endpoint;var f={};return e.utils.forOwn(r,function(t,e){f[e]=t}),e.utils._(f,u),a=makePath(i.getEndpoint(u,l,f),l,a),!1}}}),a},getPath:function getPath(t,n,r,i){i||(i={});var o=[void 0===i.basePath?void 0===n.basePath?this.basePath:n.basePath:i.basePath,this.getEndpoint(n,e.utils.isString(r)||e.utils.isNumber(r)||"create"===t?r:null,i)];return"find"!==t&&"update"!==t&&"destroy"!==t||o.push(r),makePath.apply(e.utils,o)},getParams:function getParams(t){return t||(t={}),void 0===t.params?{}:e.utils.copy(t.params)},getSuffix:function getSuffix(t,e){return e||(e={}),void 0===e.suffix?void 0===t.suffix?this.suffix:t.suffix:e.suffix},HTTP:function HTTP(t,n){var r=this,i=new Date;n||(n={});var o=t.data,a=t.cache,s=t.timeout;t=e.utils.copy(t,null,null,null,["data","cache","timeout"]),(t=e.utils.deepMixIn(t,this.httpConfig)).data=o,t.cache=a,void 0!==s&&(t.timeout=s),this.forceTrailingSlash&&"/"!==t.url[t.url.length-1]&&(t.url+="/"),t.method=t.method.toUpperCase();var u=t.suffix||n.suffix||this.suffix;u&&t.url.substr(t.url.length-u.length)!==u&&(t.url+=u);var l=function logResponse(n){var o=i.toUTCString()+" - "+t.method.toUpperCase()+" "+t.url+" - "+n.status+" "+((new Date).getTime()-i.getTime())+"ms";return n.status>=200&&n.status<300?(r.log&&r.dbg(o,n),n):(r.error&&r.error("'FAILED: "+o,n),e.utils.reject(n))};if(!this.http){if(!this.useFetch&&!n.useFetch)throw new Error("You have not configured this adapter with an http library!");if(!f)throw new Error("Attempting to use window.fetch, but it is not available!")}return e.utils.resolve(this.beforeHTTP(t,n)).then(function(i){if(t=i||t,f&&(r.useFetch||n.useFetch||!r.http))return r.fetch(t,n).then(l,l);var o=e.utils.plainCopy(t);return delete o.adapter,r.http(o).then(l,l).catch(function(e){return r.responseError(e,t,n)})}).then(function(i){return e.utils.resolve(r.afterHTTP(t,n,i)).then(function(t){return void 0===t?i:t})})},POST:function POST(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"post",a=i.op="beforePOST",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,a=i.op="POST",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(s){return a=i.op="afterPOST",e.utils.resolve(o[a](t,n,r,i,s)).then(function(t){return void 0===t?s:t})})},PUT:function PUT(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"put",a=i.op="beforePUT",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,a=i.op="PUT",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(s){return a=i.op="afterPUT",e.utils.resolve(o[a](t,n,r,i,s)).then(function(t){return void 0===t?s:t})})},queryTransform:function queryTransform(t,n,r){return r||(r={}),e.utils.isFunction(r.queryTransform)?r.queryTransform(t,n,r):e.utils.isFunction(t.queryTransform)?t.queryTransform(t,n,r):n},responseError:function responseError(t,n,r){return e.utils.reject(t)},serialize:function serialize(t,n,r){return r||(r={}),e.utils.isFunction(r.serialize)?r.serialize(t,n,r):e.utils.isFunction(t.serialize)?t.serialize(t,n,r):n},sum:function sum(t,n,r,i){if(r||(r={}),i||(i={}),!e.utils.isString(n))throw new Error("field must be a string!");return i.params=this.getParams(i),i.params.sum=n,i.suffix=this.getSuffix(t,i),e.utils.deepMixIn(i.params,r),i.params=this.queryTransform(t,i.params,i),Adapter.prototype.sum.call(this,t,n,r,i)},update:function update(t,e,n,r){return r||(r={}),r.params=this.getParams(r),r.params=this.queryTransform(t,r.params,r),r.suffix=this.getSuffix(t,r),Adapter.prototype.update.call(this,t,e,n,r)},updateAll:function updateAll(t,n,r,i){return r||(r={}),i||(i={}),i.params=this.getParams(i),e.utils.deepMixIn(i.params,r),i.params=this.queryTransform(t,i.params,i),i.suffix=this.getSuffix(t,i),Adapter.prototype.updateAll.call(this,t,n,r,i)},updateMany:function updateMany(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),Adapter.prototype.updateMany.call(this,t,e,n)}});var c={full:"3.0.0",major:3,minor:0,patch:0};t.HttpAdapter=HttpAdapter,t.addAction=addAction,t.addActions=function addActions(t){return t||(t={}),function(n){return e.utils.forOwn(t,function(t,e){addAction(e,t)(n)}),n}},t.version=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=js-data-fetch.min.map