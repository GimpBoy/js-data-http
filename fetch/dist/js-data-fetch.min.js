/*!
* js-data-fetch
* @version 3.0.0-alpha.3 - Homepage <http://www.js-data.io/docs/dshttpadapter>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2016 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview Fetch HTTP (XHR) adapter for js-data in the browser.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-data"),require("undefined")):"function"==typeof define&&define.amd?define(["js-data","undefined"],t):"object"==typeof exports?exports.DSHttpAdapter=t(require("js-data"),require("undefined")):e.DSHttpAdapter=t(e.JSData,e.undefined)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return null!=e&&""!==e}function o(e,t){return t||(t=""),e.filter(r).join(t)}function u(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];var r=o(t,"/");return r.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function a(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function i(e,t){if(!t)return e;var n=[];return y(t,function(e,t){null!==e&&"undefined"!=typeof e&&(b(e)||(e=[e]),e.forEach(function(e){"[object Date]"===window.toString.call(e)?e=e.toISOString():x(e)&&(e=U(e)),n.push(a(t)+"="+a(e))}))}),n.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+n.join("&")),e}function f(e){var t=this;e||(e={}),t.basePath=void 0===e.basePath?"":e.basePath,t.debug=void 0===e.debug?!1:e.debug,t.forceTrailingSlash=void 0===e.forceTrailingSlash?!1:e.forceTrailingSlash,t.http=void 0===e.http?p:e.http,t.httpConfig=void 0===e.httpConfig?{}:e.httpConfig,t.suffix=void 0===e.suffix?"":e.suffix,t.useFetch=void 0===e.useFetch?!1:e.useFetch}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=n(1),p=n(2),d=c.utils._,l=c.utils.copy,h=c.utils.deepMixIn,m=c.utils.extend,g=c.utils.fillIn,y=c.utils.forOwn,b=c.utils.isArray,T=c.utils.isFunction,v=c.utils.isNumber,x=c.utils.isObject,P=c.utils.isSorN,A=c.utils.isString,E=c.utils.resolve,S=c.utils.reject,U=c.utils.toJson,z=!1;try{z=window&&window.fetch}catch(e){}g(f.prototype,{afterCreate:function(){},afterCreateMany:function(){},afterDEL:function(){},afterDestroy:function(){},afterDestroyAll:function(){},afterFind:function(){},afterFindAll:function(){},afterGET:function(){},afterHTTP:function(){},afterPOST:function(){},afterPUT:function(){},afterUpdate:function(){},afterUpdateAll:function(){},afterUpdateMany:function(){},beforeCreate:function(){},beforeCreateMany:function(){},beforeDEL:function(){},beforeDestroy:function(){},beforeDestroyAll:function(){},beforeFind:function(){},beforeFindAll:function(){},beforeGET:function(){},beforeHTTP:function(){},beforePOST:function(){},beforePUT:function(){},beforeUpdate:function(){},beforeUpdateAll:function(){},beforeUpdateMany:function(){},create:function(e,t,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="create",r.dbg(n.op,e,t,n),E(r.beforeCreate(e,t,n)).then(function(){return r.POST(r.getPath("create",e,t,n),r.serialize(e,t,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterCreate(e,t,n,o)).then(function(e){return e||o})})},createMany:function(e,t,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="createMany",r.dbg(n.op,e,t,n),E(r.beforeCreateMany(e,t,n)).then(function(){return r.POST(r.getPath("createMany",e,null,n),r.serialize(e,t,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterCreateMany(e,t,n,o)).then(function(e){return e||o})})},dbg:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["debug"].concat(t))},DEL:function(e,t,n){var r=this;return t||(t={}),t.url=e||t.url,t.method=t.method||"delete",E(r.beforeDEL(e,t,n)).then(function(e){return t=e||t,r.HTTP(t,n)}).then(function(o){return E(r.afterDEL(e,t,n,o)).then(function(e){return e||o})})},deserialize:function(e,t,n){return n||(n={}),T(n.deserialize)?n.deserialize(e,t,n):T(e.deserialize)?e.deserialize(e,t,n):n.raw?t:t&&"data"in t?t.data:t},destroy:function(e,t,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="destroy",r.dbg(n.op,e,t,n),E(r.beforeDestroy(e,t,n)).then(function(){return r.DEL(r.getPath("destroy",e,t,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterDestroy(e,t,n,o)).then(function(e){return e||o})})},destroyAll:function(e,t,n){var r=this;return t||(t={}),n=n?l(n):{},n.params||(n.params={}),h(n.params,t),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="destroyAll",r.dbg(n.op,e,t,n),E(r.beforeDestroyAll(e,t,n)).then(function(){return r.DEL(r.getPath("destroyAll",e,null,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterDestroyAll(e,t,n,o)).then(function(e){return e||o})})},error:function(){if(console){var e;(e=console)["function"==typeof console.error?"error":"log"].apply(e,arguments)}},fetch:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var n={method:e.method,headers:new Headers(e.headers)};return e.data&&(n.body=U(e.data)),fetch(new Request(i(e.url,e.params),n)).then(function(t){return t.config={method:e.method,url:e.url},t.json().then(function(e){return t.data=e,t})})}),find:function(e,t,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="find",r.dbg(n.op,e,t,n),E(r.beforeFind(e,t,n)).then(function(){return r.GET(r.getPath("find",e,t,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterFind(e,t,n,o)).then(function(e){return e||o})})},findAll:function(e,t,n){var r=this;return t||(t={}),n=n?l(n):{},n.params||(n.params={}),n.suffix||(n.suffix=e.suffix),n.op="findAll",r.dbg(n.op,e,t,n),h(n.params,t),n.params=r.queryTransform(e,n.params,n),E(r.beforeFindAll(e,t,n)).then(function(){return r.GET(r.getPath("findAll",e,n.params,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterFindAll(e,t,n,o)).then(function(e){return e||o})})},GET:function(e,t,n){var r=this;return t||(t={}),t.url=e||t.url,t.method=t.method||"get",E(r.beforeGET(e,t,n)).then(function(e){return t=e||t,r.HTTP(t,n)}).then(function(o){return E(r.afterGET(e,t,n,o)).then(function(e){return e||o})})},getEndpoint:function(e,t,n){var r=this;n||(n={}),n.params||(n.params={});var o=void 0,a=e.parentKey,i=n.hasOwnProperty("endpoint")?n.endpoint:e.endpoint,f=e.parentField,c=e.parent?e.getResource(e.parent):void 0,p=n.params[a];if(p===!1||!a||!c)return p===!1&&delete n.params[a],i;if(delete n.params[a],A(t)||v(t)?o=e.get(t):x(t)&&(o=t),o&&(p=p||o[a]||(o[f]?o[f][c.idAttribute]:null)),!p)return i;var l=function(){delete n.endpoint;var e={};return y(n,function(t,n){e[n]=t}),d(e,c),{v:u(r.getEndpoint(c,p,e,p,i))}}();return"object"===("undefined"==typeof l?"undefined":s(l))?l.v:void 0},getPath:function(e,t,n,r){var o=this;r||(r={});var a=[void 0===r.basePath?void 0===t.basePath?o.basePath:t.basePath:r.basePath,o.getEndpoint(t,A(n)||v(n)||"create"===e?n:null,r)];return("find"===e||"update"===e||"destroy"===e)&&a.push(n),u.apply(c.utils,a)},HTTP:function(e,t){function n(t){var n=o.toUTCString()+" - "+e.method.toUpperCase()+" "+e.url+" - "+t.status+" "+((new Date).getTime()-o.getTime())+"ms";return t.status>=200&&t.status<300?(r.log&&r.dbg("debug",n,t),t):(r.error&&r.error("'FAILED: "+n,t),S(t))}var r=this,o=new Date;t||(t={}),e=l(e),e=h(e,r.httpConfig),r.forceTrailingSlash&&"/"!==e.url[e.url.length-1]&&(e.url+="/"),e.method=e.method.toUpperCase();var u=e.suffix||t.suffix||r.suffix;if(u&&e.url.substr(e.url.length-u.length)!==u&&(e.url+=u),!r.http)throw new Error("You have not configured this adapter with an http library!");return E(r.beforeHTTP(e,t)).then(function(o){return e=o||e,z&&(r.useFetch||t.useFetch||!r.http)?r.fetch(e,t).then(n,n):r.http(e).then(n,n).catch(function(n){return r.responseError(n,e,t)})}).then(function(n){return E(r.afterHTTP(e,t,n)).then(function(e){return e||n})})},log:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];if(e&&!n.length&&(n.push(e),e="debug"),"debug"!==e||this.debug){var o=e.toUpperCase()+": ("+this.name+")";if(console[e]){var u;(u=console)[e].apply(u,[o].concat(n))}else{var a;(a=console).log.apply(a,[o].concat(n))}}},POST:function(e,t,n,r){var o=this;return n||(n={}),n.url=e||n.url,n.data=t||n.data,n.method=n.method||"post",E(o.beforePOST(e,t,n,r)).then(function(e){return n=e||n,o.HTTP(n,r)}).then(function(u){return E(o.afterPOST(e,t,n,r,u)).then(function(e){return e||u})})},PUT:function(e,t,n,r){var o=this;return n||(n={}),n.url=e||n.url,n.data=t||n.data,n.method=n.method||"put",E(o.beforePUT(e,t,n,r)).then(function(e){return n=e||n,o.HTTP(n,r)}).then(function(u){return E(o.afterPUT(e,t,n,r,u)).then(function(e){return e||u})})},queryTransform:function(e,t,n){return n||(n={}),T(n.queryTransform)?n.queryTransform(e,t,n):T(e.queryTransform)?e.queryTransform(e,t,n):t},responseError:function(e,t,n){return S(e)},serialize:function(e,t,n){return n||(n={}),T(n.serialize)?n.serialize(e,t,n):T(e.serialize)?e.serialize(e,t,n):t},update:function(e,t,n,r){var o=this;return r=r?l(r):{},r.params||(r.params={}),r.params=o.queryTransform(e,r.params,r),r.suffix||(r.suffix=e.suffix),r.op="update",o.dbg(r.op,e,t,n,r),E(o.beforeUpdate(e,t,n,r)).then(function(){return o.PUT(o.getPath("update",e,t,r),o.serialize(e,n,r),r)}).then(function(t){return o.deserialize(e,t,r)}).then(function(u){return E(o.afterUpdate(e,t,n,r,u)).then(function(e){return e||u})})},updateAll:function(e,t,n,r){var o=this;return n||(n={}),r=r?l(r):{},r.params||(r.params={}),h(r.params,n),r.params=o.queryTransform(e,r.params,r),r.suffix||(r.suffix=e.suffix),r.op="updateAll",o.dbg(r.op,e,t,n,r),E(o.beforeUpdateAll(e,t,n,r)).then(function(){return o.PUT(o.getPath("updateAll",e,null,r),o.serialize(e,t,r),r)}).then(function(t){return o.deserialize(e,t,r)}).then(function(u){return E(o.afterUpdateAll(e,t,n,r,u)).then(function(e){return e||u})})},updateMany:function(e,t,n){var r=this;return n=n?l(n):{},n.params||(n.params={}),n.params=r.queryTransform(e,n.params,n),n.suffix||(n.suffix=e.suffix),n.op="updateMany",r.dbg(n.op,e,t,n),E(r.beforeUpdateMany(e,t,n)).then(function(){return r.PUT(r.getPath("updateMany",e,null,n),r.serialize(e,t,n),n)}).then(function(t){return r.deserialize(e,t,n)}).then(function(o){return E(r.afterUpdateMany(e,t,n,o)).then(function(e){return e||o})})}}),f.addAction=function(e,t){if(!e||!A(e))throw new TypeError("action(name[, opts]): Expected: string, Found: "+("undefined"==typeof e?"undefined":s(e)));return function(n){if(n[e])throw new Error("action(name[, opts]): "+e+" already exists on target!");return t.request=t.request||function(e){return e},t.response=t.response||function(e){return e},t.responseError=t.responseError||function(e){return S(e)},n[e]=function(n,r){x(n)&&(r=n),r=r||{};var o=this.getAdapter(t.adapter||this.defaultAdapter||"http"),a={};if(g(a,t),!r.hasOwnProperty("endpoint")&&a.endpoint&&(r.endpoint=a.endpoint),"function"==typeof r.getEndpoint)a.url=r.getEndpoint(this,r);else{var i=[r.basePath||this.basePath||o.defaults.basePath,o.getEndpoint(this,P(n)?n:null,r)];P(n)&&i.push(n),i.push(t.pathname||e),a.url=u.apply(null,i)}return a.method=a.method||"GET",a.modelName=this.name,h(a)(r),E(a).then(r.request||t.request).then(function(e){return o.HTTP(e)}).then(function(e){return e&&e.config&&(e.config.modelName=this.name),e}).then(r.response||t.response,r.responseError||t.responseError)},n}},f.addActions=function(e){return e||(e={}),function(e){return y(e,function(t,n){f.addAction(n,t)(e)}),e}},f.extend=m,f.version={full:"<%= pkg.version %>",major:parseInt("<%= major %>",10),minor:parseInt("<%= minor %>",10),patch:parseInt("<%= patch %>",10),alpha:"<%= alpha %>",beta:"<%= beta %>"},e.exports=f},function(t,n){t.exports=e},function(e,t){e.exports=void 0}])});
//# sourceMappingURL=fetch/dist/js-data-fetch.min.map