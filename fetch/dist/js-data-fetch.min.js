/*!
* js-data-fetch
* @version 3.0.0-alpha.4 - Homepage <https://github.com/js-data/js-data-http>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2016 Jason Dobry
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview Fetch HTTP (XHR) adapter for js-data in the browser.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-data"),require("undefined")):"function"==typeof define&&define.amd?define(["js-data","undefined"],t):"object"==typeof exports?exports.HttpAdapter=t(require("js-data"),require("undefined")):e.HttpAdapter=t(e.JSData,e.undefined)}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return null!=e&&""!==e}function o(e,t){return t||(t=""),e.filter(n).join(t)}function a(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=o(t,"/");return n.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function u(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function i(e,t){if(!t)return e;var r=[];return b(t,function(e,t){null!==e&&"undefined"!=typeof e&&(v(e)||(e=[e]),e.forEach(function(e){"[object Date]"===window.toString.call(e)?e=e.toISOString():P(e)&&(e=D(e)),r.push(u(t)+"="+u(e))}))}),r.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+r.join("&")),e}function f(e){var t=this;e||(e={}),y(t,e),y(t,j)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},p=r(1),d=r(2),l=p.utils._,c=p.utils.addHiddenPropsToTarget,h=p.utils.copy,m=p.utils.deepMixIn,g=p.utils.extend,y=p.utils.fillIn,b=p.utils.forOwn,v=p.utils.isArray,T=p.utils.isFunction,x=p.utils.isNumber,P=p.utils.isObject,A=p.utils.isSorN,E=p.utils.isString,U=p.utils.isUndefined,z=p.utils.resolve,q=p.utils.reject,D=p.utils.toJson,S=!1;try{S=window&&window.fetch}catch(e){}var w=function(){for(var e=this,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];var o=r[r.length-1];e.dbg.apply(e,[o.op].concat(r))},C=function(){for(var e=this,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];var o=r[r.length-2];e.dbg.apply(e,[o.op].concat(r))},j={basePath:"",debug:!1,forceTrailingSlash:!1,http:d,httpConfig:{},suffix:"",useFetch:!1};c(f.prototype,{afterCreate:C,afterCreateMany:C,afterDEL:C,afterDestroy:C,afterDestroyAll:C,afterFind:C,afterFindAll:C,afterGET:C,afterHTTP:C,afterPOST:C,afterPUT:C,afterUpdate:C,afterUpdateAll:C,afterUpdateMany:C,beforeCreate:w,beforeCreateMany:w,beforeDEL:w,beforeDestroy:w,beforeDestroyAll:w,beforeFind:w,beforeFindAll:w,beforeGET:w,beforeHTTP:w,beforePOST:w,beforePUT:w,beforeUpdate:w,beforeUpdateAll:w,beforeUpdateMany:w,create:function(e,t,r){var n=this,o=void 0;return r=r?h(r):{},r.params||(r.params={}),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeCreate",z(n[o](e,t,r)).then(function(){return o=r.op="create",n.dbg(o,e,t,r),n.POST(n.getPath("create",e,t,r),n.serialize(e,t,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterCreate",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},createMany:function(e,t,r){var n=this,o=void 0;return r=r?h(r):{},r.params||(r.params={}),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeCreateMany",z(n[o](e,t,r)).then(function(){return o=r.op="createMany",n.dbg(o,e,t,r),n.POST(n.getPath("createMany",e,null,r),n.serialize(e,t,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterCreateMany",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},dbg:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];this.log.apply(this,["debug"].concat(t))},DEL:function(e,t,r){var n=this,o=void 0;return t||(t={}),r||(r={}),t.url=e||t.url,t.method=t.method||"delete",o=r.op="beforeDEL",z(n[o](e,t,r)).then(function(a){return t=U(a)?t:a,o=r.op="DEL",n.dbg(o,e,t,r),n.HTTP(t,r)}).then(function(a){return o=r.op="afterDEL",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},deserialize:function(e,t,r){return r||(r={}),T(r.deserialize)?r.deserialize(e,t,r):T(e.deserialize)?e.deserialize(e,t,r):r.raw?t:t&&"data"in t?t.data:t},destroy:function(e,t,r){var n=this,o=void 0;return r=r?h(r):{},r.params||(r.params={}),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeDestroy",z(n[o](e,t,r)).then(function(){return o=r.op="destroy",n.dbg(o,e,t,r),n.DEL(n.getPath("destroy",e,t,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterDestroy",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},destroyAll:function(e,t,r){var n=this,o=void 0;return t||(t={}),r=r?h(r):{},r.params||(r.params={}),m(r.params,t),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeDestroyAll",z(n.beforeDestroyAll(e,t,r)).then(function(){return o=r.op="destroyAll",n.dbg(o,e,t,r),n.DEL(n.getPath("destroyAll",e,null,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterDestroyAll",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},error:function(){if(console){var e;(e=console)["function"==typeof console.error?"error":"log"].apply(e,arguments)}},fetch:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var r={method:e.method,headers:new Headers(e.headers)};return e.data&&(r.body=D(e.data)),fetch(new Request(i(e.url,e.params),r)).then(function(t){return t.config={method:e.method,url:e.url},t.json().then(function(e){return t.data=e,t})})}),find:function(e,t,r){var n=this,o=void 0;return r=r?h(r):{},r.params||(r.params={}),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeFind",z(n[o](e,t,r)).then(function(){return o=r.op="find",n.dbg(o,e,t,r),n.GET(n.getPath("find",e,t,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterFind",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},findAll:function(e,t,r){var n=this,o=void 0;return t||(t={}),r=r?h(r):{},r.params||(r.params={}),r.suffix=U(r.suffix)?e.suffix:r.suffix,m(r.params,t),r.params=n.queryTransform(e,r.params,r),o=r.op="beforeFindAll",z(n[o](e,t,r)).then(function(){return o=r.op="findAll",n.dbg(o,e,t,r),n.GET(n.getPath("findAll",e,r.params,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterFindAll",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},GET:function(e,t,r){var n=this,o=void 0;return t||(t={}),r||(r={}),t.url=e||t.url,t.method=t.method||"get",o=r.op="beforeGET",z(n[o](e,t,r)).then(function(a){return t=U(a)?t:a,o=r.op="GET",n.dbg(o,e,t,r),n.HTTP(t,r)}).then(function(a){return o=r.op="afterGET",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})},getEndpoint:function(e,t,r){var n=this;r||(r={}),r.params||(r.params={});var o=void 0,u=e.parentKey,i=r.hasOwnProperty("endpoint")?r.endpoint:e.endpoint,f=e.parentField,p=e.parent?e.getResource(e.parent):void 0,d=r.params[u];if(d===!1||!u||!p)return d===!1&&delete r.params[u],i;if(delete r.params[u],E(t)||x(t)?o=e.get(t):P(t)&&(o=t),o&&(d=d||o[u]||(o[f]?o[f][p.idAttribute]:null)),!d)return i;var c=function(){delete r.endpoint;var e={};return b(r,function(t,r){e[r]=t}),l(e,p),{v:a(n.getEndpoint(p,d,e,d,i))}}();return"object"===("undefined"==typeof c?"undefined":s(c))?c.v:void 0},getPath:function(e,t,r,n){var o=this;n||(n={});var u=[void 0===n.basePath?void 0===t.basePath?o.basePath:t.basePath:n.basePath,o.getEndpoint(t,E(r)||x(r)||"create"===e?r:null,n)];return("find"===e||"update"===e||"destroy"===e)&&u.push(r),a.apply(p.utils,u)},HTTP:function(e,t){function r(t){var r=o.toUTCString()+" - "+e.method.toUpperCase()+" "+e.url+" - "+t.status+" "+((new Date).getTime()-o.getTime())+"ms";return t.status>=200&&t.status<300?(n.log&&n.dbg("debug",r,t),t):(n.error&&n.error("'FAILED: "+r,t),q(t))}var n=this,o=new Date;t||(t={}),e=h(e),e=m(e,n.httpConfig),n.forceTrailingSlash&&"/"!==e.url[e.url.length-1]&&(e.url+="/"),e.method=e.method.toUpperCase();var a=e.suffix||t.suffix||n.suffix;if(a&&e.url.substr(e.url.length-a.length)!==a&&(e.url+=a),!n.http)throw new Error("You have not configured this adapter with an http library!");return z(n.beforeHTTP(e,t)).then(function(o){return e=o||e,S&&(n.useFetch||t.useFetch||!n.http)?n.fetch(e,t).then(r,r):n.http(e).then(r,r).catch(function(r){return n.responseError(r,e,t)})}).then(function(r){return z(n.afterHTTP(e,t,r)).then(function(e){return e||r})})},log:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];if(e&&!r.length&&(r.push(e),e="debug"),"debug"!==e||this.debug){var o=e.toUpperCase()+": (HttpAdapter)";if(console[e]){var a;(a=console)[e].apply(a,[o].concat(r))}else{var u;(u=console).log.apply(u,[o].concat(r))}}},POST:function(e,t,r,n){var o=this,a=void 0;return r||(r={}),n||(n={}),r.url=e||r.url,r.data=t||r.data,r.method=r.method||"post",a=n.op="beforePOST",z(o[a](e,t,r,n)).then(function(u){return r=U(u)?r:u,a=n.op="POST",o.dbg(a,e,t,r,n),o.HTTP(r,n)}).then(function(u){return a=n.op="afterPOST",z(o[a](e,t,r,n,u)).then(function(e){return U(e)?u:e})})},PUT:function(e,t,r,n){var o=this,a=void 0;return r||(r={}),n||(n={}),r.url=e||r.url,r.data=t||r.data,r.method=r.method||"put",a=n.op="beforePUT",z(o[a](e,t,r,n)).then(function(u){return r=U(u)?r:u,a=n.op="PUT",o.dbg(a,e,t,r,n),o.HTTP(r,n)}).then(function(u){return a=n.op="afterPUT",z(o[a](e,t,r,n,u)).then(function(e){return U(e)?u:e})})},queryTransform:function(e,t,r){return r||(r={}),T(r.queryTransform)?r.queryTransform(e,t,r):T(e.queryTransform)?e.queryTransform(e,t,r):t},responseError:function(e,t,r){return q(e)},serialize:function(e,t,r){return r||(r={}),T(r.serialize)?r.serialize(e,t,r):T(e.serialize)?e.serialize(e,t,r):t},update:function(e,t,r,n){var o=this,a=void 0;return n=n?h(n):{},n.params||(n.params={}),n.params=o.queryTransform(e,n.params,n),n.suffix=U(n.suffix)?e.suffix:n.suffix,a=n.op="beforeUpdate",z(o[a](e,t,r,n)).then(function(){return a=n.op="update",o.dbg(a,e,t,r,n),o.PUT(o.getPath("update",e,t,n),o.serialize(e,r,n),n)}).then(function(t){return o.deserialize(e,t,n)}).then(function(u){return a=n.op="afterUpdate",z(o[a](e,t,r,n,u)).then(function(e){return U(e)?u:e})})},updateAll:function(e,t,r,n){var o=this,a=void 0;return r||(r={}),n=n?h(n):{},n.params||(n.params={}),m(n.params,r),n.params=o.queryTransform(e,n.params,n),n.suffix=U(n.suffix)?e.suffix:n.suffix,a=n.op="beforeUpdateAll",z(o[a](e,t,r,n)).then(function(){return a=n.op="updateAll",o.dbg(a,e,t,r,n),o.PUT(o.getPath("updateAll",e,null,n),o.serialize(e,t,n),n)}).then(function(t){return o.deserialize(e,t,n)}).then(function(u){return a=n.op="afterUpdateAll",z(o[a](e,t,r,n,u)).then(function(e){return U(e)?u:e})})},updateMany:function(e,t,r){var n=this,o=void 0;return r=r?h(r):{},r.params||(r.params={}),r.params=n.queryTransform(e,r.params,r),r.suffix=U(r.suffix)?e.suffix:r.suffix,o=r.op="beforeUpdateMany",z(n[o](e,t,r)).then(function(){return o=r.op="updateMany",n.dbg(o,e,t,r),n.PUT(n.getPath("updateMany",e,null,r),n.serialize(e,t,r),r)}).then(function(t){return n.deserialize(e,t,r)}).then(function(a){return o=r.op="afterUpdateMany",z(n[o](e,t,r,a)).then(function(e){return U(e)?a:e})})}}),f.addAction=function(e,t){if(!e||!E(e))throw new TypeError("action(name[, opts]): Expected: string, Found: "+("undefined"==typeof e?"undefined":s(e)));return function(r){if(r[e])throw new Error("action(name[, opts]): "+e+" already exists on target!");return t.request=t.request||function(e){return e},t.response=t.response||function(e){return e},t.responseError=t.responseError||function(e){return q(e)},r[e]=function(r,n){var o=this;P(r)&&(n=r),n=n||{};var u=o.getAdapter(t.adapter||o.defaultAdapter||"http"),i={};if(y(i,t),!n.hasOwnProperty("endpoint")&&i.endpoint&&(n.endpoint=i.endpoint),"function"==typeof n.getEndpoint)i.url=n.getEndpoint(o,n);else{var f=[n.basePath||o.basePath||u.basePath,u.getEndpoint(o,A(r)?r:null,n)];A(r)&&f.push(r),f.push(t.pathname||e),i.url=a.apply(null,f)}return i.method=i.method||"GET",i.mapper=o.name,m(i)(n),z(i).then(n.request||t.request).then(function(e){return u.HTTP(e)}).then(function(e){return e&&e.config&&(e.config.mapper=o.name),e}).then(n.response||t.response,n.responseError||t.responseError)},r}},f.addActions=function(e){return e||(e={}),function(e){return b(e,function(t,r){f.addAction(r,t)(e)}),e}},f.extend=g,f.version={full:"<%= pkg.version %>",major:parseInt("<%= major %>",10),minor:parseInt("<%= minor %>",10),patch:parseInt("<%= patch %>",10),alpha:"<%= alpha %>",beta:"<%= beta %>"},e.exports=f},function(t,r){t.exports=e},function(e,t){e.exports=void 0}])});
//# sourceMappingURL=fetch/dist/js-data-fetch.min.map